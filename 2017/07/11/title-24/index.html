<!DOCTYPE html>




<html class="theme-next mist" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="面试前夕," />





  <link rel="alternate" href="/atom.xml" title="dayDream's blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="开始上网，输入 url当我们开始输入 url 的时候，浏览器就已经开始匹配 url ，从历史纪录，书签等，找到已经输入的字符串可能对应的 url ，然后给出智能提示，自动补全等。 解析URL 浏览器通过 URL 能够知道下面的信息：  Protocol “http”使用HTTP协议 Resource “/“请求的资源是主页(index)输入的是 URL 还是搜索的关键字？当协议或主机名不合法时">
<meta name="keywords" content="面试前夕">
<meta property="og:type" content="article">
<meta property="og:title" content="url 从输入到页面渲染完成到底发生了什么">
<meta property="og:url" content="http:\\hexin.life/2017/07/11/title-24/index.html">
<meta property="og:site_name" content="dayDream&#39;s blog">
<meta property="og:description" content="开始上网，输入 url当我们开始输入 url 的时候，浏览器就已经开始匹配 url ，从历史纪录，书签等，找到已经输入的字符串可能对应的 url ，然后给出智能提示，自动补全等。 解析URL 浏览器通过 URL 能够知道下面的信息：  Protocol “http”使用HTTP协议 Resource “/“请求的资源是主页(index)输入的是 URL 还是搜索的关键字？当协议或主机名不合法时">
<meta property="og:image" content="http://or3233yyd.bkt.clouddn.com//17-8-9/69469932.jpg">
<meta property="og:image" content="http://or3233yyd.bkt.clouddn.com//17-8-9/12752710.jpg">
<meta property="og:image" content="http://or3233yyd.bkt.clouddn.com//17-8-9/51034741.jpg">
<meta property="og:image" content="http://or3233yyd.bkt.clouddn.com//17-8-9/16138101.jpg">
<meta property="og:image" content="http://or3233yyd.bkt.clouddn.com//17-8-9/65736963.jpg">
<meta property="og:image" content="http://or3233yyd.bkt.clouddn.com//17-8-9/26447488.jpg">
<meta property="og:image" content="http://or3233yyd.bkt.clouddn.com//17-8-9/67016800.jpg">
<meta property="og:image" content="http://www.2cto.com/uploadfile/Collfiles/20150518/201505180932502.jpg?_=6547807">
<meta property="og:image" content="http://hexin.life/2017/07/11/title-24/1502292587253.png">
<meta property="og:image" content="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015091501.png">
<meta property="og:image" content="http://7tszky.com1.z0.glb.clouddn.com/Fs-4pQMkTCUIeOj0XjSDdZkHzs0N">
<meta property="og:image" content="http://7tszky.com1.z0.glb.clouddn.com/FvpCzlwc6Hk2RSNfE8P0Ro-kHtCj">
<meta property="og:image" content="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015091509.jpg">
<meta property="og:image" content="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015091511.png">
<meta property="og:image" content="http://7tszky.com1.z0.glb.clouddn.com/FvpCzlwc6Hk2RSNfE8P0Ro-kHtCj">
<meta property="og:image" content="http://7tszky.com1.z0.glb.clouddn.com/FsMdOZZS2iL7mLQ2xczi4xDsSGxQ">
<meta property="og:image" content="http://7tszky.com1.z0.glb.clouddn.com/FtvQWJEJtFB2uLArF0JIb-wVjpZ7">
<meta property="og:image" content="http://7tszky.com1.z0.glb.clouddn.com/FsFHqgtq4u-cfnruLkusj1qOqwh6">
<meta property="og:image" content="http://7tszky.com1.z0.glb.clouddn.com/Fv8mWt_14BnfBbe_pllVfN-WzfHG">
<meta property="og:image" content="http://fex.baidu.com/img/what-happen/nwind-weibo.png">
<meta property="og:updated_time" content="2017-08-09T17:35:54.173Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="url 从输入到页面渲染完成到底发生了什么">
<meta name="twitter:description" content="开始上网，输入 url当我们开始输入 url 的时候，浏览器就已经开始匹配 url ，从历史纪录，书签等，找到已经输入的字符串可能对应的 url ，然后给出智能提示，自动补全等。 解析URL 浏览器通过 URL 能够知道下面的信息：  Protocol “http”使用HTTP协议 Resource “/“请求的资源是主页(index)输入的是 URL 还是搜索的关键字？当协议或主机名不合法时">
<meta name="twitter:image" content="http://or3233yyd.bkt.clouddn.com//17-8-9/69469932.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http:\\hexin.life/2017/07/11/title-24/"/>





  <title>url 从输入到页面渲染完成到底发生了什么 | dayDream's blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">dayDream's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http:\\hexin.life/2017/07/11/title-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="白日梦想家">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dayDream's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">url 从输入到页面渲染完成到底发生了什么</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-11T21:32:07+08:00">
                2017-07-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <link rel="stylesheet" type="text/css" href="/assets/css/DPlayer.min.css"><script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="开始上网，输入-url"><a href="#开始上网，输入-url" class="headerlink" title="开始上网，输入 url"></a>开始上网，输入 url</h1><p>当我们开始输入 url 的时候，浏览器就已经开始匹配 url ，从历史纪录，书签等，找到已经输入的字符串可能对应的 url ，然后给出智能提示，自动补全等。<br><img src="http://or3233yyd.bkt.clouddn.com//17-8-9/69469932.jpg" alt=""></p>
<h1 id="解析URL"><a href="#解析URL" class="headerlink" title="解析URL"></a>解析URL</h1><ul>
<li><p>浏览器通过 URL 能够知道下面的信息：</p>
<ul>
<li>Protocol “http”<br>使用HTTP协议</li>
<li>Resource “/“<br>请求的资源是主页(index)<h1 id="输入的是-URL-还是搜索的关键字？"><a href="#输入的是-URL-还是搜索的关键字？" class="headerlink" title="输入的是 URL 还是搜索的关键字？"></a>输入的是 URL 还是搜索的关键字？</h1>当协议或主机名不合法时，浏览器会将地址栏中输入的文字传给默认的搜索引擎。大部分情况下，在把文字传递给搜索引擎的时候，URL会带有特定的一串字符，用来告诉搜索引擎这次搜索来自这个特定浏览器。<h1 id="转换非-ASCII-的-Unicode-字符"><a href="#转换非-ASCII-的-Unicode-字符" class="headerlink" title="转换非 ASCII 的 Unicode 字符"></a>转换非 ASCII 的 Unicode 字符</h1></li>
</ul>
</li>
<li>浏览器检查输入是否含有不是 a-z， A-Z，0-9， - 或者 . 的字符</li>
<li>这里主机名是 google.com ，所以没有非ASCII的字符；如果有的话，浏览器会对主机名部分使用 Punycode 编码<h1 id="检查-HSTS-列表"><a href="#检查-HSTS-列表" class="headerlink" title="检查 HSTS 列表"></a>检查 HSTS 列表</h1></li>
<li>浏览器检查自带的“预加载 HSTS（HTTP严格传输安全）”列表，这个列表里包含了那些请求浏览器只使用HTTPS进行连接的网站</li>
<li>如果网站在这个列表里，浏览器会使用 HTTPS 而不是 HTTP 协议，否则，最初的请求会使用HTTP协议发送</li>
<li>注意，一个网站哪怕不在 HSTS 列表里，也可以要求浏览器对自己使用 HSTS 政策进行访问。浏览器向网站发出第一个 HTTP 请求之后，网站会返回浏览器一个响应，请求浏览器只使用 HTTPS 发送请求。然而，就是这第一个 HTTP 请求，却可能会使用户受到 <a href="http://en.wikipedia.org/wiki/SSL_stripping" target="_blank" rel="external">downgrade attack</a> 的威胁，这也是为什么现代浏览器都预置了 HSTS 列表。<h1 id="浏览器查找-url-的-Ip-地址"><a href="#浏览器查找-url-的-Ip-地址" class="headerlink" title="浏览器查找 url 的 Ip 地址"></a>浏览器查找 url 的 Ip 地址</h1></li>
</ul>
<ol>
<li>浏览器检查域名是否在缓存当中（要查看 Chrome 当中的缓存， 打开 chrome://net-internals/#dns）。</li>
<li>首先查看本地硬盘的 host 文件，查看其中有没有和这个域名对应的规则，如果找到，就直接使用 host 中的 ip 地址。</li>
<li>如果 host 中没能找到对应的 ip 地址，浏览器会发出一个 DNS 请求到本地 DNS 服务器，即网络接入提供商(中国移动，中国电信等)</li>
<li>本地 DNS 服务器查询它的缓存记录，如果有就直接返回查询结果，此过程是递归查询，如果没有则会向 DNS 根服务器查询</li>
<li>跟服务器没有相应的记录时，就告诉本地 DNS 服务器可以去域名服务器查询，并告知域名服务器的 IP，</li>
<li>本地服务器向域名服务器发出请求，在下图中请求的对象是 .com 服务器， .com 服务器收到请求后，也不会直接返回对应关系，而是告诉本地 DNS 服务器，你所查询的域名的服务器的地址。</li>
<li>本地服务器向查询的域名服务器发出请求，此时能收到相应的域名和 IP 的地址，本地 DNS 不仅要把返回的 IP 和域名返回给用户还要把这个关系保存到缓存中，以防下次用户请求时，可以快速返回结果，加快了网络的访问。</li>
</ol>
<p><img src="http://or3233yyd.bkt.clouddn.com//17-8-9/12752710.jpg" alt="域名解析-盗图"></p>
<blockquote>
<p><a href="https://zh.wikipedia.org/wiki/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F" target="_blank" rel="external">关于 DNS</a></p>
</blockquote>
<h1 id="浏览器向-Web-服务器发出-HTTP-请求"><a href="#浏览器向-Web-服务器发出-HTTP-请求" class="headerlink" title="浏览器向 Web 服务器发出 HTTP 请求"></a>浏览器向 Web 服务器发出 HTTP 请求</h1><p>拿到域名对应的 IP 地址之后，浏览器会以随机一个( 1024 &lt; 端口号 &lt; 65535 ) 向 Web 服务器 ( nginx ) 的 80 端口号发出 TCP 的连接请求，经过各种路由设备(局域网除外)，<br>到达网卡，进入到内核的 TCP/IP 协议栈( 识别连接请求，解封包等 )，最终到达 Web 应用程序，建立起了 TCP/IP 连接。</p>
<p><img src="http://or3233yyd.bkt.clouddn.com//17-8-9/51034741.jpg" alt=""></p>
<p>建立起 TCP 连接之后，发起一个 HTTP 请求 ( 一般常用是 get post )。<br>一般一个 HTTP 请求包含：</p>
<ul>
<li>请求的 url 协议/版本</li>
<li>请求头 request header</li>
<li>请求体 request body</li>
</ul>
<p><img src="http://or3233yyd.bkt.clouddn.com//17-8-9/16138101.jpg" alt=""></p>
<p><img src="http://or3233yyd.bkt.clouddn.com//17-8-9/65736963.jpg" alt=""></p>
<blockquote>
<p>最后一个请求头后面是空行，发送回车符和换行符，通知服务器以下不再是请求头</p>
</blockquote>
<p><img src="http://or3233yyd.bkt.clouddn.com//17-8-9/26447488.jpg" alt=""></p>
<blockquote>
<p><a href="https://github.com/jawil/blog/issues/14" target="_blank" rel="external">TCP 三次握手与四次挥手</a><br> <a href="http://blog.csdn.net/whuslei/article/details/6667471/" target="_blank" rel="external">TCP协议中的三次握手和四次挥手(图解)</a></p>
</blockquote>
<h1 id="服务器的永久重定向响应"><a href="#服务器的永久重定向响应" class="headerlink" title="服务器的永久重定向响应"></a>服务器的永久重定向响应</h1><p>服务器给浏览器响应一个 301 的永久重定向，这样浏览器访问 <a href="http://www.google.com" target="_blank" rel="external">http://www.google.com</a> 而不是 <a href="http://google.com" target="_blank" rel="external">http://google.com</a> ，这是由于搜索引擎排名的原因，比如我的网站为了输入方便，在进行 DNS 解析时，将 <a href="http://www.hexin.life" target="_blank" rel="external">http://www.hexin.life</a> 和 <a href="http://hexin.life">http://hexin.life</a> 定位到了同一网站下，搜素引擎会认为他们是俩个网站，从而造成搜索排名下降。而当 301 重定向之后，搜素引擎便会把含  www 的和不含的放在同一个网站排名中，而且使用 www 和非 www 时，也会缓存多次，所以会进行 301 的重定向。</p>
<blockquote>
<p><a href="https://aotu.io/notes/2016/01/28/3xx-of-http-status/" target="_blank" rel="external">你所知道的3xx状态码</a></p>
</blockquote>
<h1 id="浏览器跟踪重定向地址"><a href="#浏览器跟踪重定向地址" class="headerlink" title="浏览器跟踪重定向地址"></a>浏览器跟踪重定向地址</h1><p>再次向正确地址发送 HTTP 请求</p>
<h1 id="服务器处理请求"><a href="#服务器处理请求" class="headerlink" title="服务器处理请求"></a>服务器处理请求</h1><p>经过千辛万苦，终于将 http 发送到了我们的服务器。后端接到 TCP 报文开始，他会对 tcp 连接进行处理，对 HTTP 根据协议进行解析，按照报文格式一步一步封装成 HTTP request 对象，供上层使用。</p>
<p><img src="http://or3233yyd.bkt.clouddn.com//17-8-9/67016800.jpg" alt=""></p>
<p>大一点的网站会请求到<a href="https://github.com/moonbingbing/openresty-best-practices/blob/master/ngx/reverse_proxy.md" target="_blank" rel="external">反向代理</a>中，因为网站访问量越来越大，网站速度也就变慢了，此时客户端不再直接通过 HTTP 协议访问某网站的应用服务器，而是先请求到 Nginx ， Nginx 再请求应用服务器，然后再将结果返回给客户端，这里 Nginx 的作用时反向代理服务器，同时如果一台服务器挂了，只要其他服务器还在正常运行，网站就能正常使用。</p>
<p><img src="http://www.2cto.com/uploadfile/Collfiles/20150518/201505180932502.jpg?_=6547807" alt=""></p>
<h1 id="服务器返回-HTTP-请求"><a href="#服务器返回-HTTP-请求" class="headerlink" title="服务器返回 HTTP 请求"></a>服务器返回 HTTP 请求</h1><p>响应类似请求：</p>
<ul>
<li>状态行</li>
<li>响应头</li>
<li>响应体</li>
</ul>
<p><img src="./1502292587253.png" alt="Alt text"></p>
<h2 id="响应状态码"><a href="#响应状态码" class="headerlink" title="响应状态码"></a>响应状态码</h2><ol>
<li>1xx：信息性状态码，表示服务器已接收了客户端请求，客户端可继续发送请求。</li>
</ol>
<ul>
<li><p>100 Continue</p>
</li>
<li><p>101 Switching Protocols</p>
</li>
</ul>
<ol>
<li>2xx：成功状态码，表示服务器已成功接收到请求并进行处理。</li>
</ol>
<ul>
<li><p>200 OK 表示客户端请求成功</p>
</li>
<li><p>204 No Content 成功，但不返回任何实体的主体部分</p>
</li>
<li><p>206 Partial Content 成功执行了一个范围（Range）请求</p>
</li>
</ul>
<ol>
<li>3xx：重定向状态码，表示服务器要求客户端重定向。</li>
</ol>
<ul>
<li><p>301 Moved Permanently 永久性重定向，响应报文的Location首部应该有该资源的新URL</p>
</li>
<li><p>302 Found 临时性重定向，响应报文的Location首部给出的URL用来临时定位资源</p>
</li>
<li><p>303 See Other 请求的资源存在着另一个URI，客户端应使用GET方法定向获取请求的资源</p>
</li>
<li><p>304 Not Modified 服务器内容没有更新，可以直接读取浏览器缓存</p>
</li>
<li><p>307 Temporary Redirect 临时重定向。与302 Found含义一样。302禁止POST变换为GET，但实际使用时并不一定，307则更多浏览器可能会遵循这一标准，但也依赖于浏览器具体实现</p>
</li>
</ul>
<ol>
<li>4xx：客户端错误状态码，表示客户端的请求有非法内容。</li>
</ol>
<ul>
<li><p>400 Bad Request 表示客户端请求有语法错误，不能被服务器所理解</p>
</li>
<li><p>401 Unauthonzed 表示请求未经授权，该状态代码必须与 WWW-Authenticate 报头域一起使用</p>
</li>
<li><p>403 Forbidden 表示服务器收到请求，但是拒绝提供服务，通常会在响应正文中给出不提供服务的原因</p>
</li>
<li><p>404 Not Found 请求的资源不存在，例如，输入了错误的URL</p>
</li>
</ul>
<ol>
<li>5xx：服务器错误状态码，表示服务器未能正常处理客户端的请求而出现意外错误。</li>
</ol>
<ul>
<li><p>500 Internel Server Error 表示服务器发生不可预期的错误，导致无法完成客户端的请求</p>
</li>
<li><p>503 Service Unavailable 表示服务器当前不能够处理客户端的请求，在一段时间之后，服务器可能会恢复正常</p>
</li>
</ul>
<blockquote>
<p><a href="https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81" target="_blank" rel="external">HTTP状态码</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status" target="_blank" rel="external">HTTP response codes</a><br><a href="http://www.alloyteam.com/2016/07/httphttp2-0spdyhttps-reading-this-is-enough/" target="_blank" rel="external">HTTP,HTTP2.0,SPDY,HTTPS你应该知道的一些事</a></p>
</blockquote>
<h1 id="浏览器渲染-html"><a href="#浏览器渲染-html" class="headerlink" title="浏览器渲染 html"></a>浏览器渲染 html</h1><p>浏览器在解析html文件时，会”自上而下“加载，并在加载过程中进行解析渲染。在解析过程中，如果遇到请求外部资源时，如图片、外链的CSS、iconfont等，请求过程是异步的，并不会影响html文档进行加载。</p>
<ol>
<li>首先是解析 HTML 构建 DOM 树 =&gt; </li>
<li>解析 CSS 解析为 CSSOM =&gt;</li>
<li>结合 DOM  和 CSSOM 生成 render tree(每个节点的视觉信息) =&gt;</li>
<li>生成布局 layout =&gt;</li>
<li>将布局绘制到屏幕 </li>
</ol>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015091501.png" alt=""></p>
<p>这五步中，三四步比较慢生成布局和绘制合成渲染<br><img src="http://7tszky.com1.z0.glb.clouddn.com/Fs-4pQMkTCUIeOj0XjSDdZkHzs0N" alt=""></p>
<p>当文档加载过程中遇到js文件，html文档会挂起渲染（加载解析渲染同步）的线程，不仅要等待文档中js文件加载完毕，还要等待解析执行完毕，才可以恢复html文档的渲染线程。因为JS有可能会修改DOM，最为经典的document.write，这意味着，在JS执行完成前，后续所有资源的下载可能是没有必要的，这是js阻塞后续资源下载的根本原因。所以我明平时的代码中，js是放在html文档末尾的。</p>
<p>DOM 树<br><img src="http://7tszky.com1.z0.glb.clouddn.com/FvpCzlwc6Hk2RSNfE8P0Ro-kHtCj" alt=""></p>
<blockquote>
<p>DOM 树中的每一个需要显示的节点再渲染树中至少存在一个对应的节点，隐藏的 DOM 元素则没有对应节点，渲染树中的节点被称为 “帧（frames）”或“盒（boxes）”，<br>符合 CSS 模型的定义，一旦DOM 树和渲染树构建完成，浏览器就开始显示绘制元素</p>
</blockquote>
<p>很多时候，密集的重新渲染是无法避免的，比如scroll事件的回调函数和网页动画。<br>网页动画的每一帧（frame）都是一次重新渲染。每秒低于24帧的动画，人眼就能感受到停顿。一般的网页动画，需要达到每秒30帧到60帧的频率，才能比较流畅。如果能达到每秒70帧甚至80帧，就会极其流畅。</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015091509.jpg" alt=""></p>
<p>大多数显示器的刷新频率是60Hz，为了与系统一致，以及节省电力，浏览器会自动按照这个频率，刷新动画（如果可以做到的话）。<br>所以，如果网页动画能够做到每秒60帧，就会跟显示器同步刷新，达到最佳的视觉效果。这意味着，一秒之内进行60次重新渲染，每次重新渲染的时间不能超过16.66毫秒。</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015091511.png" alt=""></p>
<p>一秒之间能够完成多少次重新渲染，这个指标就被称为”刷新率”，英文为FPS（frame per second）。60次重新渲染，就是60FPS。<br>如果想达到60帧的刷新率，就意味着JavaScript线程每个任务的耗时，必须少于16毫秒。一个解决办法是使用Web Worker，主线程只用于UI渲染，然后跟UI渲染不相干的任务，都放在Worker线程。</p>
<h2 id="DOM-解析"><a href="#DOM-解析" class="headerlink" title="DOM 解析"></a>DOM 解析</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;Web page parsing&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">    &lt;div&gt;</div><div class="line">        &lt;h1&gt;Web page parsing&lt;/h1&gt;</div><div class="line">        &lt;p&gt;This is an example Web page.&lt;/p&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>DOM 解析成这样<br><img src="http://7tszky.com1.z0.glb.clouddn.com/FvpCzlwc6Hk2RSNfE8P0Ro-kHtCj" alt=""></p>
<h2 id="CSS-解析"><a href="#CSS-解析" class="headerlink" title="CSS 解析"></a>CSS 解析</h2><p>假设有下面这样的 DOM 结构<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;doc&gt;</div><div class="line">&lt;title&gt;A few quotes&lt;/title&gt;</div><div class="line">&lt;para&gt;</div><div class="line">  Franklin said that &lt;quote&gt;&quot;A penny saved is a penny earned.&quot;&lt;/quote&gt;</div><div class="line">&lt;/para&gt;</div><div class="line">&lt;para&gt;</div><div class="line">  FDR said &lt;quote&gt;&quot;We have nothing to fear but &lt;span&gt;fear itself.&lt;/span&gt;&quot;&lt;/quote&gt;</div><div class="line">&lt;/para&gt;</div><div class="line">&lt;/doc&gt;</div></pre></td></tr></table></figure></p>
<p>CSS 文档<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> /* rule 1 */ doc &#123; display: block; text-indent: 1em; &#125;</div><div class="line">/* rule 2 */ title &#123; display: block; font-size: 3em; &#125;</div><div class="line">/* rule 3 */ para &#123; display: block; &#125;</div><div class="line">/* rule 4 */ [class=&quot;emph&quot;] &#123; font-style: italic; &#125;</div></pre></td></tr></table></figure></p>
<p>CSS Rule tree 时这样<br><img src="http://7tszky.com1.z0.glb.clouddn.com/FsMdOZZS2iL7mLQ2xczi4xDsSGxQ" alt=""></p>
<blockquote>
<ul>
<li>图中的第4条规则出现了两次，一次是独立的，一次是在规则3的子结点。所以，我们可以知道，建立CSS Rule Tree是需要比照着DOM Tree来的。CSS匹配DOM Tree主要是从右到左解析CSS的Selector，好多人以为这个事会比较快，其实并不一定。关键还看我们的CSS的Selector怎么写了。</li>
<li>CSS匹配HTML元素是一个相当复杂和有性能问题的事情。所以，你就会在N多地方看到很多人都告诉你，DOM树要小，CSS尽量用id和class，千万不要过渡层叠下去</li>
</ul>
</blockquote>
<p>通过这俩个树我们可以得到一个叫 Style Context Tree<br><img src="http://7tszky.com1.z0.glb.clouddn.com/FtvQWJEJtFB2uLArF0JIb-wVjpZ7" alt=""></p>
<blockquote>
<p>所以，Firefox基本上来说是通过CSS 解析 生成 CSS Rule Tree，然后，通过比对DOM生成Style Context Tree，然后Firefox通过把Style Context Tree和其Render Tree（Frame Tree）关联上，就完成了。注意：Render Tree会把一些不可见的结点去除掉。而Firefox中所谓的Frame就是一个DOM结点，不要被其名字所迷惑了。</p>
</blockquote>
<p><img src="http://7tszky.com1.z0.glb.clouddn.com/FsFHqgtq4u-cfnruLkusj1qOqwh6" alt=""><br><em>在 Firefox 中，系统会针对 DOM 更新注册展示层，作为侦听器。展示层将框架创建工作委托给FrameConstructor，由该构造器解析样式（请参阅样式计算）并创建框架。<br>在 WebKit 中，解析样式和创建呈现器的过程称为“附加”。每个 DOM 节点都有一个“attach”方法。附加是同步进行的，将节点插入 DOM 树需要调用新的节点“attach”方法</em></p>
<h2 id="渲染"><a href="#渲染" class="headerlink" title="渲染"></a>渲染</h2><ol>
<li><a href="http://blog.csdn.net/xllily_11/article/details/54426119" target="_blank" rel="external">计算 CSS 样式</a></li>
<li>构建 render tree</li>
<li>Layout </li>
<li>开始绘制</li>
</ol>
<p><img src="http://7tszky.com1.z0.glb.clouddn.com/Fv8mWt_14BnfBbe_pllVfN-WzfHG" alt=""></p>
<blockquote>
<p>上图流程中有很多连接线，这表示了Javascript动态修改了DOM属性或是CSS属会导致重新Layout，有些改变不会，就是那些指到天上的箭头，比如，修改后的CSS rule没有被匹配到，等。</p>
</blockquote>
<h2 id="Repaint"><a href="#Repaint" class="headerlink" title="Repaint"></a>Repaint</h2><p>屏幕的一部分要重画，比如某个元素的 CSS 背景变了，但尺寸没有变</p>
<h2 id="Reflow"><a href="#Reflow" class="headerlink" title="Reflow"></a>Reflow</h2><p>当  DOM 的变化影响了元素的几何属性 =&gt; 比如改变边框宽度或者给段落增加文字，导致行数增加 =&gt; 浏览器需要重新计算元素的几何属性，同样其他元素的几何属性和位置也会收到影响，浏览器会使渲染树中受到影响部分失效，并重新构造渲染树，发生重排，完成重排后，浏览器会重新绘制受影响部分的元素到屏幕中，也会发生重绘。</p>
<ul>
<li>样式表越简单，重排和重绘就越快。</li>
<li>重排和重绘的DOM元素层级越高，成本就越高。</li>
<li>table元素的重排和重绘成本，要高于div元素<h3 id="发生重绘"><a href="#发生重绘" class="headerlink" title="发生重绘"></a>发生重绘</h3></li>
<li>当你增加、删除、修改DOM结点时，会导致Reflow或Repaint</li>
<li>当你移动DOM的位置，或是搞个动画的时候。(元素位置发生改变)</li>
<li>当你修改CSS样式的时候。或者页面渲染初始化</li>
<li>当你Resize窗口的时候（移动端没有这个问题），或是滚动的时候。</li>
<li>当你修改网页的默认字体时。</li>
<li>元素尺寸发生改变(边距， 高度等)</li>
<li>注：display:none会触发reflow，而visibility:hidden只会触发repaint，因为没有发现位置变化。<h3 id="渲染树的变化的排队与刷新"><a href="#渲染树的变化的排队与刷新" class="headerlink" title="渲染树的变化的排队与刷新"></a>渲染树的变化的排队与刷新</h3>由于每次重排都行会产生消耗，大多数浏览器通过队列化修改并批量执行来优化重排过程，然而，你可能会不知不觉的强制刷新对了要求计划立刻执行，获取布局的信息会导致队列刷新</li>
<li>offsetTop, offsetBottom, offsetWidth, offsetHeight</li>
<li>scrollTop,  scrollBottom, scrollWidth, scrollHeight</li>
<li>clientTop,  clientBottom, clientWidth, clientHeight</li>
<li>getComputedStyle() =&gt;( currentStyle in IE)<br>以上属性和方法需要返回最新的布局信息，因此浏览器不得不执行渲染队列中的‘待处理变化’并触发重排以返回正确的值。<blockquote>
<p>“重绘”不一定需要”重排” —- “重排”必然导致”重绘”</p>
</blockquote>
</li>
</ul>
<h3 id="最小化重绘和重排"><a href="#最小化重绘和重排" class="headerlink" title="最小化重绘和重排"></a>最小化重绘和重排</h3><ul>
<li>改变样式 =&gt; 不要一条条地改变样式，多个改变合并 =&gt; 直接更换 CSS 的 Class </li>
<li>批量修改 DOM =&gt; 使元素脱离文档流(隐藏显示，使用文档片段，拷贝到一个脱离文档的节点中完成后再替换) =&gt; 修改 =&gt; 带回文档</li>
<li>动画使用绝对定位，使用拖放代理</li>
<li>缓存布局信息 =&gt; 偏移量，滚动位置， 计算出的样式等 获取一次后赋值给局部遍历</li>
<li>事件委托 =&gt; 减少事件处理器的数量</li>
</ul>
<h1 id="浏览器请求嵌在-HTML-中的资源-图片，视频音频，-CSS，-JavaScript-等"><a href="#浏览器请求嵌在-HTML-中的资源-图片，视频音频，-CSS，-JavaScript-等" class="headerlink" title="浏览器请求嵌在 HTML 中的资源(图片，视频音频， CSS， JavaScript 等)"></a>浏览器请求嵌在 HTML 中的资源(图片，视频音频， CSS， JavaScript 等)</h1><p>其实这个步骤可以并列在步骤8中，在浏览器显示HTML时，它会注意到需要获取其他地址内容的标签。这时，浏览器会发送一个获取请求来重新获得这些文件。比如我要获取外图片，CSS，JS文件等，类似于下面的链接：</p>
<p>图片：<a href="http://or3233yyd.bkt.clouddn.com//17-8-9/67016800.jpg" target="_blank" rel="external">http://or3233yyd.bkt.clouddn.com//17-8-9/67016800.jpg</a></p>
<p>CSS式样表：<a href="https://cdn.bootcss.com/animate.css/3.5.2/animate.css" target="_blank" rel="external">https://cdn.bootcss.com/animate.css/3.5.2/animate.css</a></p>
<p>JavaScript 文件：<a href="https://cdn.bootcss.com/jquery/3.2.1/core.js" target="_blank" rel="external">https://cdn.bootcss.com/jquery/3.2.1/core.js</a></p>
<p>　　这些地址都要经历一个和HTML读取类似的过程。所以浏览器会在DNS中查找这些域名，发送请求，重定向等等…</p>
<p>不像动态页面，静态文件会允许浏览器对其进行缓存。有的文件可能会不需要与服务器通讯，而从缓存中直接读取，或者可以放到CDN中</p>
<h1 id="转载整理："><a href="#转载整理：" class="headerlink" title="转载整理："></a>转载整理：</h1><p><img src="http://fex.baidu.com/img/what-happen/nwind-weibo.png" alt=""></p>
<ul>
<li><a href="http://www.kuqin.com/shuoit/20170324/353413.html" target="_blank" rel="external">老生常谈从输入url 到页面展示到底发生了什么</a></li>
<li><a href="https://github.com/skyline75489/what-happens-when-zh_CN" target="_blank" rel="external">当···时发生了什么？=&gt; 推荐 </a></li>
<li><a href="http://blog.csdn.net/xllily_11/article/details/54426119" target="_blank" rel="external">作为前端你不得不知-浏览器的工作原理：网络浏览器幕后揭秘</a></li>
<li><a href="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/#Parsing_general" target="_blank" rel="external">浏览器的工作原理：新式网络浏览器幕后揭秘 – more than </a></li>
<li><a href="http://fex.baidu.com/blog/2014/05/what-happen/" target="_blank" rel="external">从输入 URL 到页面加载完成的过程中都发生了什么事情？=&gt; 太恐怖，涉及硬件，感兴趣就去挑战吧</a></li>
<li><a href="http://imweb.io/topic/56841c864c44bcc56092e3fa" target="_blank" rel="external">浏览器渲染原理</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2015/09/web-page-performance-in-depth.html" target="_blank" rel="external">网页性能管理详解</a></li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>本文作者：</strong>
      白日梦想家
    </li>
    <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http:\\hexin.life/2017/07/11/title-24/" title="url 从输入到页面渲染完成到底发生了什么">http:\\hexin.life/2017/07/11/title-24/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明： </strong>
      本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
    </li>
  </ul>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/面试前夕/" rel="tag"># 面试前夕</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/07/11/title-16/" rel="next" title="前端性能优化">
                <i class="fa fa-chevron-left"></i> 前端性能优化
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/07/17/title-17/" rel="prev" title="正则表达式学习">
                正则表达式学习 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="uyan_frame"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="白日梦想家" />
          <p class="site-author-name" itemprop="name">白日梦想家</p>
           
              <p class="site-description motion-element" itemprop="description">那些一起做的白日梦，你还记得么</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/18292843691" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:hexin_9508@163.com" target="_blank" title="邮箱">
                  
                    <i class="fa fa-fw fa-mail"></i>
                  
                  邮箱
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        

        

      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#开始上网，输入-url"><span class="nav-number">1.</span> <span class="nav-text">开始上网，输入 url</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#解析URL"><span class="nav-number">2.</span> <span class="nav-text">解析URL</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#输入的是-URL-还是搜索的关键字？"><span class="nav-number">3.</span> <span class="nav-text">输入的是 URL 还是搜索的关键字？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#转换非-ASCII-的-Unicode-字符"><span class="nav-number">4.</span> <span class="nav-text">转换非 ASCII 的 Unicode 字符</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#检查-HSTS-列表"><span class="nav-number">5.</span> <span class="nav-text">检查 HSTS 列表</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#浏览器查找-url-的-Ip-地址"><span class="nav-number">6.</span> <span class="nav-text">浏览器查找 url 的 Ip 地址</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#浏览器向-Web-服务器发出-HTTP-请求"><span class="nav-number">7.</span> <span class="nav-text">浏览器向 Web 服务器发出 HTTP 请求</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#服务器的永久重定向响应"><span class="nav-number">8.</span> <span class="nav-text">服务器的永久重定向响应</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#浏览器跟踪重定向地址"><span class="nav-number">9.</span> <span class="nav-text">浏览器跟踪重定向地址</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#服务器处理请求"><span class="nav-number">10.</span> <span class="nav-text">服务器处理请求</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#服务器返回-HTTP-请求"><span class="nav-number">11.</span> <span class="nav-text">服务器返回 HTTP 请求</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#响应状态码"><span class="nav-number">11.1.</span> <span class="nav-text">响应状态码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#浏览器渲染-html"><span class="nav-number">12.</span> <span class="nav-text">浏览器渲染 html</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DOM-解析"><span class="nav-number">12.1.</span> <span class="nav-text">DOM 解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSS-解析"><span class="nav-number">12.2.</span> <span class="nav-text">CSS 解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#渲染"><span class="nav-number">12.3.</span> <span class="nav-text">渲染</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Repaint"><span class="nav-number">12.4.</span> <span class="nav-text">Repaint</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reflow"><span class="nav-number">12.5.</span> <span class="nav-text">Reflow</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#发生重绘"><span class="nav-number">12.5.1.</span> <span class="nav-text">发生重绘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#渲染树的变化的排队与刷新"><span class="nav-number">12.5.2.</span> <span class="nav-text">渲染树的变化的排队与刷新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#最小化重绘和重排"><span class="nav-number">12.5.3.</span> <span class="nav-text">最小化重绘和重排</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#浏览器请求嵌在-HTML-中的资源-图片，视频音频，-CSS，-JavaScript-等"><span class="nav-number">13.</span> <span class="nav-text">浏览器请求嵌在 HTML 中的资源(图片，视频音频， CSS， JavaScript 等)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#转载整理："><span class="nav-number">14.</span> <span class="nav-text">转载整理：</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">白日梦想家</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  
    

    
      <!-- UY BEGIN -->
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2139345"></script>
      <!-- UY END -->
    
  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
